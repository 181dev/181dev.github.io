<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>hashrock</title>
  <link href='http://fonts.googleapis.com/css?family=Flamenco:300' rel='stylesheet' type='text/css'>
  <style>
  body {
    background: rgb(232, 255, 207);
  }
  circle{
    fill: green;
    opacity: 0.9;
  }
  text {
    text-anchor: middle;
    fill: #A6E44A;
    font-size: 5rem;
    font-family: 'devicons', 'Flamenco', cursive;
  }
  g > a > text{
    fill: white;
    font-size: 1.5rem;
  }
  text#Description{
    font-size: 1.5rem;
  }
  </style>
</head>
<body>
  <svg id="main">
    <text x="50%" y="50%" dy=".3em">hashrock</text>
    <text x="50%" y="50%" dy="2.2em" id="Description">Frontend engineer, Japan, Tokyo</text>
  </svg>

<script src="lib/jquery-1.11.0.min.js"></script>
<script src="lib/d3.min.js"></script>
<script>
/*global d3:false */
var w = $(window).width();
var h = $(window).height();
var svg = d3.select("svg#main")
  .attr("width", w)
  .attr("height", h);

$.getJSON("https://script.google.com/macros/s/AKfycbwyeA6IX_t1QE9lyBpIPzGkhdJWlYqT1Z7jpd-aT0FRi9ycrox1/exec", function(data){
    var force = d3.layout.force()
            .nodes(data)
            .gravity(0.05)
            .charge([-600])
            .size([w, h]);

    var nodes = force.nodes();

    var onmouseDuration = 200;
    var g;
    var node;

    function calc(){
        node = svg.selectAll("g").data(nodes);
        node.exit().remove();
        g = node.enter().insert("g").append("a");

        g.attr("xlink:href", function(d) {return d.url;});
        g.on("mouseover", function(){
            d3.select(this)
                    .select("circle")
                    .transition().duration(onmouseDuration)
                    .style("fill","white");
            d3.select(this)
                    .select("text")
                    .style("fill","green");
        })
                .on("mouseout", function(){
                    d3.select(this)
                            .select("circle")
                            .transition().duration(onmouseDuration)
                            .style("fill","green");
                    d3.select(this)
                            .select("text")
                            .style("fill","white");
                })
                .on("click", function(){
                });

        g.append("circle")
                .attr("r", function(d){return d.r;});

        g.append("text")
                .text(function(d){
                    return d.text;
                });


        force.on("tick", function(){
            node.attr("transform", function(d){return "translate(" + d.x + "," + d.y + ")";});
        });

        node.call(force.drag);
        force.start();

    }

    calc();

    setInterval(function(){
        data.push({text: "", r: 10, url: ""});
        calc();
    }, 1000);

    setInterval(function(){
        setTimeout(function(){
            data.splice(6, 1);
            calc();
        }, 200);
        setTimeout(function(){
            data.splice(6, 1);
            calc();
        }, 400);
        setTimeout(function(){
            data.splice(6, 1);
            calc();
        }, 600);
    }, 3000);
});


</script>
</body>
</html>
